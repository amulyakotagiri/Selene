<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="ac9babc4cb488d06" />
    <title>Selene - Lunar Pomodoro Timer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%23ffffff'/%3E%3C/svg%3E">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
            background: #000;
        }

        .galaxy-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #2a0a4e 0%, #1a0033 50%, #000000 100%);
            z-index: 0;
        }

        .galaxy-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(168, 192, 255, 0.15) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 70%, rgba(196, 113, 237, 0.12) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 50%, rgba(255, 255, 255, 0.05) 0%, transparent 60%);
            animation: shimmer 10s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
            animation: twinkle 3s infinite, float 100s linear infinite;
            transition: transform 0.3s ease-out;
            pointer-events: auto;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100px, -200px); }
        }

        .container {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
            color: white;
        }

        .logo {
            font-size: 3rem;
            font-weight: 300;
            letter-spacing: 8px;
            margin-bottom: 0.5rem;
            margin-top: 3rem;
            background: linear-gradient(to right, #a8c0ff, #c471ed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1rem;
            letter-spacing: 3px;
            color: #a8c0ff;
            margin-bottom: 3rem;
            opacity: 0.8;
        }

        .moon-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 2rem 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .moon-container:hover {
            transform: scale(1.05);
        }

        .moon-container:active {
            transform: scale(0.98);
        }

        .moon {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #ffffff, #ffffff, #fafafa);
            position: relative;
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.6);
            transition: all 0.5s ease;
            overflow: hidden;
            filter: brightness(1.3);
        }

        .moon::before {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            background: rgba(230, 230, 230, 0.3);
            border-radius: 50%;
            top: 28%;
            left: 32%;
            box-shadow: 
                45px 35px 0 -4px rgba(230, 230, 230, 0.25),
                -18px 55px 0 -6px rgba(230, 230, 230, 0.2),
                65px -8px 0 -2px rgba(230, 230, 230, 0.28);
        }

        .moon-shadow {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: #0a0015;
            transition: transform 0.5s ease;
            transform-origin: right center;
            z-index: 2;
            border-radius: 50%;
            transform: translateX(0%) scaleX(1.5);
        }

        .moon-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #0a0015;
            z-index: 3;
            transition: opacity 0.5s ease;
            opacity: 1;
        }

        .glow {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 340px;
            height: 340px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 300;
            margin: 2rem 0 1rem;
            letter-spacing: 4px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .phase-display {
            font-size: 1.2rem;
            color: #c471ed;
            margin-bottom: 1rem;
            letter-spacing: 2px;
            text-align: center;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .sound-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 3;
            background: rgba(168, 192, 255, 0.2);
            border: 2px solid #a8c0ff;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .frequency-selector {
            position: fixed;
            top: 4rem;
            right: 1rem;
            z-index: 3;
            background: rgba(168, 192, 255, 0.2);
            border: 2px solid #a8c0ff;
            padding: 0.8rem 1rem;
            border-radius: 15px;
            color: white;
            backdrop-filter: blur(10px);
            font-size: 0.85rem;
        }

        .frequency-selector select {
            background: rgba(168, 192, 255, 0.3);
            border: 1px solid #a8c0ff;
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-top: 0.5rem;
            width: 100%;
        }

        .frequency-selector select option {
            background: #1a0033;
        }

        .upgrade-section {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            z-index: 3;
        }

        .upgrade-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a0033 0%, #2d0a4e 100%);
            padding: 2rem;
            border-radius: 20px;
            max-width: 550px;
            width: 90%;
            margin: 1rem;
            border: 2px solid #a8c0ff;
            box-shadow: 0 0 50px rgba(168, 192, 255, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #a8c0ff, #c471ed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .pricing-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .price-card {
            background: rgba(168, 192, 255, 0.08);
            border: 2px solid rgba(168, 192, 255, 0.3);
            border-radius: 15px;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .price-card.active {
            border-color: #c471ed;
            background: rgba(196, 113, 237, 0.2);
            box-shadow: 0 0 25px rgba(196, 113, 237, 0.4);
        }

        .price-amount {
            font-size: 2.5rem;
            color: #e0e0ff;
            font-weight: bold;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid #a8c0ff;
            padding: 0.8rem 1.5rem;
            margin-top: 1rem;
            color: #e0e0ff;
            width: 100%;
            border-radius: 50px;
            cursor: pointer;
        }

        .premium-preview {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(168, 192, 255, 0.05);
            border: 2px solid rgba(168, 192, 255, 0.2);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            max-width: 800px;
        }

        .premium-preview h3 {
            color: #c471ed;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
            letter-spacing: 2px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .feature-card {
            background: rgba(168, 192, 255, 0.08);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(168, 192, 255, 0.2);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            background: rgba(168, 192, 255, 0.15);
            border-color: #a8c0ff;
            transform: translateY(-2px);
        }

        .feature-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .feature-card h4 {
            color: #a8c0ff;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .feature-card p {
            color: #e0e0ff;
            font-size: 0.85rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .logo { font-size: 2.5rem; }
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="galaxy-bg"></div>
    <div class="stars" id="stars"></div>

    <button class="sound-toggle" id="soundToggle">üîä Sound: ON</button>

    <div class="frequency-selector">
        <label style="color: #a8c0ff; display: block; margin-bottom: 0.3rem;">üéµ Focus Frequency</label>
        <select id="frequencySelect">
            <option value="40">40 Hz - Gamma (Focus)</option>
            <option value="432">432 Hz - Healing</option>
            <option value="528">528 Hz - Transformation</option>
            <option value="639">639 Hz - Connection</option>
            <option value="741">741 Hz - Awakening</option>
            <option value="852">852 Hz - Intuition</option>
        </select>
    </div>

    <div class="container">
        <h1 class="logo">SELENE</h1>
        <p class="subtitle">LUNAR POMODORO TIMER</p>

        <div class="moon-container" id="moonContainer">
            <div class="glow"></div>
            <div class="moon" id="moon">
                <div class="moon-shadow" id="moonShadow"></div>
                <div class="moon-overlay" id="moonOverlay"></div>
            </div>
        </div>

        <div class="timer-display" id="timer">25:00</div>
        <div class="phase-display" id="phase">üåë New Moon - üéØ Focus Time - Cycle 1/4</div>
        <p style="color: #a8c0ff; opacity: 0.6; margin-top: 1rem; font-size: 0.9rem;">‚ú® Click the moon to start ‚ú®</p>
        
        <!-- Premium Features Preview -->
        <div class="premium-preview">
            <h3>‚ú® Unlock Selene Pro ‚ú®</h3>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="icon">ü™ê</div>
                    <h4>Premium Nebulas</h4>
                    <p>Crab, Orion, Eagle & Ring nebula backgrounds with animated particles</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üåå</div>
                    <h4>Galaxy Themes</h4>
                    <p>Andromeda, Whirlpool, Sombrero galaxies with spiral animations</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üéß</div>
                    <h4>Celestial Sounds</h4>
                    <p>Pulsar rhythms, cosmic winds, stellar harmonics & binaural beats</p>
                </div>
                <div class="feature-card">
                    <div class="icon">‚òÑÔ∏è</div>
                    <h4>Shooting Stars</h4>
                    <p>Meteor animations crossing your screen during focus sessions</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üìà</div>
                    <h4>Focus Analytics</h4>
                    <p>Track productivity patterns, streaks & completion rates over time</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üé®</div>
                    <h4>Custom Moons</h4>
                    <p>Different moon textures, colors & phase animations to match your mood</p>
                </div>
            </div>
            <button class="upgrade-btn" onclick="document.getElementById('upgradeModal').style.display='flex'" style="width: 100%; font-size: 1.1rem; padding: 1.2rem;">
                üåü Join Pro Waitlist - Get 50% Off at Launch
            </button>
        </div>
        
        <!-- Notification Banner -->
        <div id="notificationBanner" style="display: none; background: rgba(196, 113, 237, 0.2); border: 2px solid #c471ed; border-radius: 15px; padding: 1rem 1.5rem; margin-top: 1.5rem; max-width: 500px; text-align: center;">
            <p style="color: #e0e0ff; margin-bottom: 0.8rem; font-size: 0.95rem;">
                üîî <strong>Enable notifications to get alerts when your timer ends!</strong>
            </p>
            <button id="enableNotifications" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 0.7rem 1.5rem; border-radius: 50px; color: white; cursor: pointer; font-weight: 600; font-size: 0.9rem;">
                Enable Notifications
            </button>
            <button id="dismissBanner" style="background: rgba(255, 255, 255, 0.1); border: 1px solid #a8c0ff; padding: 0.7rem 1.5rem; border-radius: 50px; color: #e0e0ff; cursor: pointer; font-size: 0.9rem; margin-left: 0.5rem;">
                Maybe Later
            </button>
        </div>
    </div>

    <div class="upgrade-section">
        <button class="upgrade-btn" id="upgradeBtn">üåü Join Pro Waitlist</button>
    </div>

    <div class="modal" id="upgradeModal">
        <div class="modal-content">
            <h2>Selene Pro</h2>
            <p style="color: #e0e0ff; text-align: center; margin-bottom: 1rem;">Join the waitlist for early access</p>
            
            <div class="pricing-container">
                <div class="price-card active">
                    <div class="price-amount">‚Çπ299</div>
                    <div style="color: #a8c0ff;">per month</div>
                </div>
                <div class="price-card">
                    <div class="price-amount">‚Çπ749</div>
                    <div style="color: #a8c0ff;">per year</div>
                    <div style="color: #4ade80; font-size: 0.85rem; margin-top: 0.5rem;">Save 79%</div>
                </div>
            </div>
            
            <div style="margin: 1rem 0;">
                <input type="email" id="waitlistEmail" placeholder="Enter your email" style="width: 100%; padding: 1rem; border: 2px solid rgba(168, 192, 255, 0.3); border-radius: 50px; background: rgba(168, 192, 255, 0.05); color: #e0e0ff; font-size: 1rem; margin-bottom: 0.5rem; outline: none;" />
            </div>
            
            <button class="upgrade-btn" id="joinWaitlistBtn" style="width: 100%; margin-top: 1rem;">üåü Join Waitlist</button>
            <button class="close-btn" id="closeModal">Maybe Later</button>
        </div>
    </div>

    <script>
        // ========== STARS SETUP ==========
        const starsContainer = document.getElementById('stars');
        const stars = [];
        
        console.log('Creating stars...');
        
        for (let i = 0; i < 250; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 3.5 + 1; // 1px to 4.5px - LARGER
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            const baseX = Math.random() * 100;
            const baseY = Math.random() * 100;
            star.style.left = baseX + '%';
            star.style.top = baseY + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = `${Math.random() * 2 + 2}s, ${Math.random() * 50 + 80}s`;
            star.style.opacity = Math.random() * 0.6 + 0.4; // 0.4 to 1.0 opacity - BRIGHTER
            starsContainer.appendChild(star);
            stars.push({ element: star, baseX, baseY });
        }
        
        console.log('Stars created:', stars.length);

        // Mouse tracking for stars during break
        document.addEventListener('mousemove', (e) => {
            const mouseX = (e.clientX / window.innerWidth) * 100;
            const mouseY = (e.clientY / window.innerHeight) * 100;
            
            if (isBreakTime && !isRunning) {
                stars.forEach(star => {
                    const dx = mouseX - star.baseX;
                    const dy = mouseY - star.baseY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 0) {
                        const moveAmount = Math.min(30, distance / 3);
                        const moveX = (dx / distance) * moveAmount;
                        const moveY = (dy / distance) * moveAmount;
                        star.element.style.transform = `translate(${moveX}px, ${moveY}px)`;
                    }
                });
            } else {
                stars.forEach(star => {
                    star.element.style.transform = 'translate(0, 0)';
                });
            }
        });

        // ========== TIMER VARIABLES ==========
        let timeInSeconds = 25 * 60;
        let totalTime = 25 * 60;
        let isRunning = false;
        let isBreakTime = false;
        let currentCycle = 1;
        let timerEndTime = null;
        let interval = null;
        let soundEnabled = true;
        let selectedFrequency = 40;
        let audioContext = null;
        let oscillator = null;
        let wakeLock = null;

        // ========== DOM ELEMENTS ==========
        const timer = document.getElementById('timer');
        const phase = document.getElementById('phase');
        const moon = document.getElementById('moon');
        const moonShadow = document.getElementById('moonShadow');
        const moonOverlay = document.getElementById('moonOverlay');
        const moonContainer = document.getElementById('moonContainer');
        const soundToggle = document.getElementById('soundToggle');
        const frequencySelect = document.getElementById('frequencySelect');
        const upgradeBtn = document.getElementById('upgradeBtn');
        const upgradeModal = document.getElementById('upgradeModal');
        const closeModal = document.getElementById('closeModal');

        // ========== AUDIO FUNCTIONS ==========
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playAmbientSound() {
            if (!soundEnabled || !audioContext) return;
            
            stopAmbientSound();

            oscillator = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(selectedFrequency, audioContext.currentTime);
            
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(selectedFrequency * 2, audioContext.currentTime);
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.12, audioContext.currentTime + 0.1);
            
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1200, audioContext.currentTime);
            
            oscillator.connect(filter);
            oscillator2.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator2.start();
            
            window.oscillator2 = oscillator2;
        }

        function stopAmbientSound() {
            if (oscillator) {
                oscillator.stop();
                oscillator = null;
            }
            if (window.oscillator2) {
                window.oscillator2.stop();
                window.oscillator2 = null;
            }
        }

        // ========== DISPLAY UPDATES ==========
        function updateDisplay() {
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // Update page title
            if (isRunning) {
                const icon = isBreakTime ? '‚òï' : 'üéØ';
                document.title = `${icon} ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')} - Selene`;
            } else {
                document.title = 'Selene - Lunar Pomodoro Timer';
            }

            // During break, freeze moon at current phase
            if (isBreakTime) {
                const sessionType = '‚òï Break Time';
                let phaseName;
                if (currentCycle === 1) phaseName = 'üåí Waxing Crescent';
                else if (currentCycle === 2) phaseName = 'üåì First Quarter';
                else if (currentCycle === 3) phaseName = 'üåî Waxing Gibbous';
                else phaseName = 'üåï Full Moon';
                
                phase.textContent = `${phaseName} - ${sessionType} - Cycle ${currentCycle}/4`;
                return;
            }

            // Calculate moon phase progress
            const progress = (totalTime - timeInSeconds) / totalTime;
            const completedCycles = (currentCycle - 1) * 0.25;
            const totalMoonProgress = completedCycles + (progress * 0.25);

            console.log('üåô Moon progress:', {
                cycle: currentCycle,
                sessionProgress: (progress * 100).toFixed(1) + '%',
                cycleProgress: (completedCycles * 100).toFixed(1) + '%',
                totalMoonProgress: (totalMoonProgress * 100).toFixed(1) + '%'
            });

            // Phase names
            let phaseName;
            if (totalMoonProgress < 0.25) phaseName = 'üåë New Moon ‚Üí üåí Waxing Crescent';
            else if (totalMoonProgress < 0.5) phaseName = 'üåí Waxing Crescent ‚Üí üåì First Quarter';
            else if (totalMoonProgress < 0.75) phaseName = 'üåì First Quarter ‚Üí üåî Waxing Gibbous';
            else if (totalMoonProgress < 1.0) phaseName = 'üåî Waxing Gibbous ‚Üí üåï Full Moon';
            else phaseName = 'üåï‚ú® Full Moon ‚ú®';
            
            phase.textContent = `${phaseName} - üéØ Focus Time - Cycle ${currentCycle}/4`;

            // Moon visual updates - FIXED PROGRESSION
            // Overlay fades slowly across all 4 cycles
            moonOverlay.style.opacity = Math.max(0, 1 - (totalMoonProgress * 0.9));
            
            // Shadow movement - moves across 4 cycles, not 1
            // At 0%: shadow fully covers moon
            // At 25% (end cycle 1): thin crescent visible
            // At 50% (end cycle 2): half moon
            // At 75% (end cycle 3): gibbous
            // At 100% (end cycle 4): full moon
            const shadowTranslateX = totalMoonProgress * 400; // Move 400% to fully clear
            const shadowScale = Math.max(0.01, 2.0 - (totalMoonProgress * 1.99)); // Scale from 2.0 to 0.01
            moonShadow.style.transform = `translateX(${shadowTranslateX}%) scaleX(${shadowScale})`;
            
            // Brightness increases with each cycle
            const moonBrightness = 1.3 + (totalMoonProgress * 0.7); // 1.3 to 2.0
            moon.style.filter = `brightness(${moonBrightness})`;
            
            // Glow increases dramatically across all cycles
            const glowIntensity = 40 + (totalMoonProgress * 140);
            const glowOpacity = 0.6 + (totalMoonProgress * 0.4);
            moon.style.boxShadow = `
                0 0 ${glowIntensity}px rgba(255, 255, 255, ${glowOpacity}),
                0 0 ${glowIntensity * 2}px rgba(255, 255, 255, ${glowOpacity * 0.6}),
                0 0 ${glowIntensity * 3}px rgba(200, 200, 255, ${glowOpacity * 0.4})
            `;

            saveTimerState();
        }

        // ========== TIMER CONTROL ==========
        function tick() {
            if (!isRunning || !timerEndTime) return;
            
            const now = Date.now();
            const remainingMs = timerEndTime - now;
            
            if (remainingMs <= 0) {
                timeInSeconds = 0;
                updateDisplay();
                completePomodoro();
                return;
            }
            
            timeInSeconds = Math.ceil(remainingMs / 1000);
            updateDisplay();
        }

        function startTimer() {
            timerEndTime = Date.now() + (timeInSeconds * 1000);
            isRunning = true;
            
            initAudio();
            playAmbientSound();
            requestWakeLock();
            
            if (interval) clearInterval(interval);
            interval = setInterval(tick, 1000);
            tick();
            
            console.log('‚ñ∂Ô∏è Timer started:', { cycle: currentCycle, isBreak: isBreakTime, duration: timeInSeconds });
        }

        function stopTimer() {
            isRunning = false;
            if (interval) clearInterval(interval);
            timerEndTime = null;
            stopAmbientSound();
            releaseWakeLock();
            saveTimerState();
        }

        function resetTimer() {
            stopTimer();
            isBreakTime = false;
            currentCycle = 1;
            timeInSeconds = 25 * 60;
            totalTime = 25 * 60;
            updateDisplay();
            localStorage.removeItem('seleneTimerState');
        }

        function completePomodoro() {
            console.log('‚è∞ Timer complete!', { isBreak: isBreakTime, cycle: currentCycle });
            
            stopTimer();
            
            if (!isBreakTime) {
                // FOCUS COMPLETED - START BREAK
                const phases = ['Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 'Full Moon'];
                showNotification(
                    `üéâ Cycle ${currentCycle} Complete!`,
                    `Moon: ${phases[currentCycle - 1]}. Take a 5-min break. Click moon to start.`
                );
                
                isBreakTime = true;
                timeInSeconds = 5 * 60;
                totalTime = 5 * 60;
                
            } else {
                // BREAK COMPLETED - NEXT CYCLE
                isBreakTime = false;
                
                if (currentCycle >= 4) {
                    showNotification('üåï FULL MOON ACHIEVED!', 'Completed 4 cycles! Take a long break. Click to restart.');
                    currentCycle = 1;
                } else {
                    currentCycle++;
                    showNotification('‚òï Break Over!', `Ready for Cycle ${currentCycle}? Click the moon!`);
                }
                
                timeInSeconds = 25 * 60;
                totalTime = 25 * 60;
            }
            
            updateDisplay();
            moon.style.animation = 'pulse 1s ease-in-out 3';
            setTimeout(() => { moon.style.animation = ''; }, 3000);
        }

        // ========== NOTIFICATIONS ==========
        function checkNotificationPermission() {
            if (!('Notification' in window)) {
                console.log('Browser does not support notifications');
                return 'unsupported';
            }
            return Notification.permission;
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    console.log('Notification permission:', permission);
                    if (permission === 'granted') {
                        document.getElementById('notificationBanner').style.display = 'none';
                        // Show test notification
                        const testNotif = new Notification('üåô Selene Notifications Enabled!', {
                            body: 'You\'ll now receive alerts when your focus and break sessions complete.',
                            icon: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Ccircle cx="50" cy="50" r="48" fill="%23ffffff"/%3E%3C/svg%3E',
                            tag: 'selene-test',
                            requireInteraction: false
                        });
                        testNotif.onclick = () => {
                            window.focus();
                            testNotif.close();
                        };
                    } else if (permission === 'denied') {
                        showPermissionGuide();
                    }
                });
            }
        }

        function showPermissionGuide() {
            const guide = document.createElement('div');
            guide.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #1a0033 0%, #2d0a4e 100%);
                color: white; padding: 2rem; border-radius: 20px; border: 2px solid #c471ed;
                box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5); z-index: 10000;
                max-width: 90%; text-align: center;
            `;
            
            guide.innerHTML = `
                <h2 style="font-size: 1.5rem; margin-bottom: 1rem; color: #c471ed;">üîî Enable Notifications</h2>
                <p style="margin-bottom: 1rem; color: #e0e0ff;">To receive timer alerts, please enable notifications in your browser settings:</p>
                <ol style="text-align: left; color: #a8c0ff; margin-bottom: 1.5rem; padding-left: 2rem;">
                    <li>Click the üîí lock icon in the address bar</li>
                    <li>Find "Notifications" in the permissions list</li>
                    <li>Change it to "Allow"</li>
                    <li>Refresh this page</li>
                </ol>
                <button onclick="this.parentElement.remove()" style="
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    border: none; padding: 1rem 2rem; border-radius: 50px;
                    color: white; font-size: 1rem; font-weight: bold; cursor: pointer;">
                    Got it!
                </button>
            `;
            document.body.appendChild(guide);
        }

        function showNotification(title, body) {
            console.log('üîî Attempting notification:', title, body);
            
            const permission = checkNotificationPermission();
            console.log('Permission status:', permission);
            
            // Try browser notification FIRST (most important for background alerts)
            if (permission === 'granted') {
                try {
                    console.log('Creating browser notification...');
                    const notification = new Notification(title, { 
                        body, 
                        tag: 'selene-timer-' + Date.now(),
                        icon: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Cdefs%3E%3CradialGradient id="moon"%3E%3Cstop offset="0%25" stop-color="%23ffffff"/%3E%3Cstop offset="100%25" stop-color="%23e0e0e0"/%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx="50" cy="50" r="45" fill="url(%23moon)" stroke="%23cccccc" stroke-width="2"/%3E%3Ccircle cx="35" cy="35" r="4" fill="%23999" opacity="0.3"/%3E%3Ccircle cx="60" cy="45" r="5" fill="%23999" opacity="0.3"/%3E%3C/svg%3E',
                        badge: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Ccircle cx="50" cy="50" r="48" fill="%23ffffff"/%3E%3C/svg%3E',
                        requireInteraction: true,
                        silent: false,
                        vibrate: [200, 100, 200, 100, 200],
                        timestamp: Date.now(),
                        renotify: true
                    });
                    
                    notification.onclick = function() {
                        console.log('Notification clicked - focusing window');
                        window.focus();
                        notification.close();
                    };
                    
                    notification.onshow = function() {
                        console.log('‚úÖ Browser notification displayed');
                    };
                    
                    notification.onerror = function(e) {
                        console.error('‚ùå Notification display error:', e);
                    };
                    
                    notification.onclose = function() {
                        console.log('Notification closed');
                    };
                    
                    console.log('‚úÖ Browser notification created successfully');
                } catch(e) {
                    console.error('‚ùå Notification creation error:', e);
                }
            } else if (permission === 'default') {
                console.log('‚ö†Ô∏è Permission not granted, showing banner');
                setTimeout(() => {
                    const banner = document.getElementById('notificationBanner');
                    if (banner) banner.style.display = 'block';
                }, 1000);
            } else if (permission === 'denied') {
                console.log('‚ùå Notifications blocked by user - showing guide');
                showPermissionGuide();
            }
            
            // ALSO show in-page alert (for immediate visibility)
            showInPageAlert(title, body);
            
            // Play sound
            try {
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGS57OihUhELTKXh8bllHAU2jdXxz3goBS185vPTizgKEly47OulUxELTKXh8bllHAU2jdXxz3goBS185vPTizgKElw');
                audio.volume = 0.8;
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('‚úÖ Audio alert played');
                    }).catch(e => {
                        console.log('Audio play prevented:', e);
                    });
                }
            } catch(e) {
                console.log('Audio error:', e);
            }
            
            // Vibrate on mobile
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200, 100, 200]);
                console.log('üì≥ Vibration triggered');
            }
        }

        function showInPageAlert(title, body) {
            const existing = document.getElementById('inPageAlert');
            if (existing) existing.remove();
            
            const alert = document.createElement('div');
            alert.id = 'inPageAlert';
            alert.style.cssText = `
                position: fixed; 
                top: 50%; 
                left: 50%; 
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white; 
                padding: 2.5rem; 
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7); 
                z-index: 10001;
                max-width: 90%; 
                min-width: 300px;
                text-align: center; 
                animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                border: 3px solid rgba(255, 255, 255, 0.3);
            `;
            
            alert.innerHTML = `
                <h2 style="font-size: 2rem; margin-bottom: 1rem; text-shadow: 0 2px 10px rgba(0,0,0,0.3);">${title}</h2>
                <p style="font-size: 1.2rem; margin-bottom: 2rem; line-height: 1.6; opacity: 0.95;">${body}</p>
                <button onclick="this.parentElement.remove()" style="
                    background: white; 
                    color: #667eea; 
                    border: none;
                    padding: 1rem 2.5rem; 
                    border-radius: 50px; 
                    font-size: 1.1rem;
                    font-weight: bold; 
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">Got it! ‚úì</button>
            `;
            
            document.body.appendChild(alert);
            
            console.log('‚úÖ In-page alert shown');
            
            // Auto-remove after 30 seconds
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.remove();
                }
            }, 30000);
        }

        // ========== STORAGE ==========
        function saveTimerState() {
            localStorage.setItem('seleneTimerState', JSON.stringify({
                isRunning, isBreakTime, currentCycle, timerEndTime,
                timeInSeconds, totalTime, savedAt: Date.now()
            }));
        }

        function loadTimerState() {
            const saved = localStorage.getItem('seleneTimerState');
            if (!saved) return;
            
            try {
                const state = JSON.parse(saved);
                if (state.isRunning && state.timerEndTime) {
                    const remainingMs = state.timerEndTime - Date.now();
                    if (remainingMs > 0) {
                        isBreakTime = state.isBreakTime;
                        currentCycle = state.currentCycle;
                        timerEndTime = state.timerEndTime;
                        timeInSeconds = Math.ceil(remainingMs / 1000);
                        totalTime = state.totalTime;
                        startTimer();
                    } else {
                        completePomodoro();
                    }
                }
            } catch (e) {
                console.error('Load state error:', e);
            }
        }

        // ========== WAKE LOCK ==========
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                }
            } catch (e) {}
        }

        function releaseWakeLock() {
            if (wakeLock) {
                wakeLock.release();
                wakeLock = null;
            }
        }

        // ========== EVENT LISTENERS ==========
        moonContainer.addEventListener('click', () => {
            if (!isRunning) {
                if ('Notification' in window && Notification.permission === 'default') {
                    document.getElementById('notificationBanner').style.display = 'block';
                }
                startTimer();
            } else {
                resetTimer();
            }
        });

        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggle.textContent = soundEnabled ? 'üîä Sound: ON' : 'üîá Sound: OFF';
            if (!soundEnabled) stopAmbientSound();
            else if (isRunning) playAmbientSound();
        });

        frequencySelect.addEventListener('change', (e) => {
            selectedFrequency = parseFloat(e.target.value);
            if (isRunning && soundEnabled) {
                stopAmbientSound();
                playAmbientSound();
            }
        });

        // Notification permission
        document.getElementById('enableNotifications')?.addEventListener('click', () => {
            requestNotificationPermission();
        });

        document.getElementById('dismissBanner')?.addEventListener('click', () => {
            document.getElementById('notificationBanner').style.display = 'none';
        });

        // Modal
        upgradeBtn.addEventListener('click', () => {
            upgradeModal.style.display = 'flex';
        });

        closeModal.addEventListener('click', () => {
            upgradeModal.style.display = 'none';
        });

        upgradeModal.addEventListener('click', (e) => {
            if (e.target === upgradeModal) {
                upgradeModal.style.display = 'none';
            }
        });

        document.getElementById('joinWaitlistBtn')?.addEventListener('click', () => {
            const email = document.getElementById('waitlistEmail').value.trim();
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            console.log('Waitlist signup:', email);
            alert(`üéâ You're on the waitlist!\n\nWe'll email you at ${email} when Selene Pro launches.\n\nüíù Early supporters get 50% off!`);
            
            document.getElementById('waitlistEmail').value = '';
            upgradeModal.style.display = 'none';
        });

        // Visibility change
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && isRunning) {
                tick();
            } else if (!document.hidden) {
                loadTimerState();
            }
        });

        // Periodic check
        setInterval(() => {
            if (isRunning && timerEndTime) {
                const now = Date.now();
                const actualSeconds = Math.ceil((timerEndTime - now) / 1000);
                if (Math.abs(timeInSeconds - actualSeconds) > 2) {
                    tick();
                }
            }
        }, 500);

        // ========== INITIALIZATION ==========
        window.addEventListener('load', () => {
            loadTimerState();
            updateDisplay();
            
            // Check notification permission on load
            const permission = checkNotificationPermission();
            console.log('üîî Initial notification permission status:', permission);
            
            if (permission === 'default') {
                // Show banner after 3 seconds
                console.log('Showing notification permission banner in 3 seconds...');
                setTimeout(() => {
                    const banner = document.getElementById('notificationBanner');
                    if (banner) {
                        banner.style.display = 'block';
                        console.log('Banner displayed');
                    }
                }, 3000);
            } else if (permission === 'denied') {
                console.log('‚ùå Notifications are blocked. In-page alerts will be used instead.');
            } else if (permission === 'granted') {
                console.log('‚úÖ Notifications are enabled and ready');
            }
            
            // Test notification support
            if (!('Notification' in window)) {
                console.warn('‚ö†Ô∏è This browser does not support notifications');
            }
        });

        // Add bounce animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounceIn {
                0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                50% { transform: translate(-50%, -50%) scale(1.05); }
                70% { transform: translate(-50%, -50%) scale(0.9); }
                100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>