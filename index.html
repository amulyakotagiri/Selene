<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selene - Lunar Pomodoro Timer</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            overflow-y: auto;
            min-height: 100vh;
            background: #000;
        }

        .galaxy-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a0033 0%, #000000 100%);
            z-index: 0;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite, float 100s linear infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100px, -200px); }
        }

        .container {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
            color: white;
        }

        .logo {
            font-size: 3rem;
            font-weight: 300;
            letter-spacing: 8px;
            margin-bottom: 0.5rem;
            margin-top: 3rem;
            background: linear-gradient(to right, #a8c0ff, #c471ed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        @media (max-width: 768px) {
            .logo {
                font-size: 2.5rem;
                letter-spacing: 6px;
                margin-top: 3.5rem;
            }
        }

        .subtitle {
            font-size: 1rem;
            letter-spacing: 3px;
            color: #a8c0ff;
            margin-bottom: 3rem;
            opacity: 0.8;
        }

        .moon-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 2rem 0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .moon-container:hover {
            transform: scale(1.05);
        }

        .moon-container:active {
            transform: scale(0.98);
        }

        .moon {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #ffffff, #e8e8e8, #c0c0c0);
            position: relative;
            box-shadow: 0 0 60px rgba(255, 255, 255, 0.6),
                        inset -15px -15px 40px rgba(0, 0, 0, 0.2);
            transition: all 0.5s ease;
            overflow: hidden;
            opacity: 0;
        }

        .moon::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background: rgba(180, 180, 180, 0.4);
            border-radius: 50%;
            top: 25%;
            left: 30%;
            box-shadow: 
                50px 40px 0 -5px rgba(180, 180, 180, 0.3),
                -20px 60px 0 -8px rgba(180, 180, 180, 0.25),
                70px -10px 0 -3px rgba(180, 180, 180, 0.35);
        }

        .moon-shadow {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #0a0015;
            transition: transform 0.5s ease;
            transform-origin: center;
            z-index: 2;
        }

        .moon-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #0a0015;
            z-index: 3;
            transition: opacity 0.5s ease;
        }

        .glow {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 340px;
            height: 340px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .timer-display {
            font-size: 4rem;
            font-weight: 300;
            margin: 2rem 0 1rem;
            letter-spacing: 4px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .phase-display {
            font-size: 1.2rem;
            color: #c471ed;
            margin-bottom: 2rem;
            letter-spacing: 2px;
        }

        .upgrade-section {
            position: fixed;
            bottom: 1.5rem;
            left: 1.5rem;
            z-index: 3;
        }

        .upgrade-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        @media (max-width: 768px) {
            .upgrade-section {
                bottom: 1rem;
                left: 1rem;
            }
            
            .upgrade-btn {
                padding: 0.8rem 1.5rem;
                font-size: 0.9rem;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a0033 0%, #2d0a4e 100%);
            padding: 2rem;
            border-radius: 20px;
            max-width: 550px;
            width: 90%;
            margin: 1rem;
            border: 2px solid #a8c0ff;
            box-shadow: 0 0 50px rgba(168, 192, 255, 0.3);
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #a8c0ff, #c471ed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .modal-subtitle {
            color: #e0e0ff;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .plan-header {
            color: #c471ed;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 500;
        }

        .pricing-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .price-card {
            background: rgba(168, 192, 255, 0.08);
            border: 2px solid rgba(168, 192, 255, 0.3);
            border-radius: 15px;
            padding: 1.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            user-select: none;
        }

        .price-card:hover {
            border-color: #a8c0ff;
            background: rgba(168, 192, 255, 0.15);
            transform: translateY(-2px);
        }

        .price-card:active {
            transform: translateY(0);
        }

        .price-card.active {
            border-color: #c471ed;
            background: rgba(196, 113, 237, 0.2);
            box-shadow: 0 0 25px rgba(196, 113, 237, 0.4);
            transform: scale(1.02);
        }

        .best-value {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            white-space: nowrap;
        }

        .price-amount {
            font-size: 2.5rem;
            color: #e0e0ff;
            font-weight: bold;
            line-height: 1;
            margin: 0.5rem 0;
        }

        .price-period {
            color: #a8c0ff;
            font-size: 0.95rem;
        }

        .price-savings {
            color: #4ade80;
            font-size: 0.8rem;
            margin-top: 0.5rem;
            font-weight: 600;
        }

        .features {
            list-style: none;
            margin: 1.5rem 0;
        }

        .features li {
            padding: 0.8rem;
            margin: 0.4rem 0;
            background: rgba(168, 192, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #c471ed;
            color: #e0e0ff;
            font-size: 0.9rem;
        }

        .payment-info {
            background: rgba(168, 192, 255, 0.15);
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid #c471ed;
        }

        .payment-info p {
            color: #e0e0ff;
            margin: 0;
            font-size: 0.9rem;
        }

        .subscribe-btn {
            width: 100%;
            padding: 1.2rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            letter-spacing: 1px;
            font-weight: 600;
            margin-top: 1rem;
        }

        .subscribe-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid #a8c0ff;
            padding: 0.8rem 1.5rem;
            margin-top: 1rem;
            color: #e0e0ff;
            width: 100%;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .sound-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 3;
            background: rgba(168, 192, 255, 0.2);
            border: 2px solid #a8c0ff;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .sound-toggle:hover {
            background: rgba(168, 192, 255, 0.3);
        }

        @media (max-width: 768px) {
            .sound-toggle {
                top: 0.5rem;
                right: 0.5rem;
                padding: 0.5rem 0.8rem;
                font-size: 0.75rem;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .modal h2 {
                font-size: 1.5rem;
            }

            .pricing-container {
                gap: 0.8rem;
            }

            .price-card {
                padding: 1.2rem 0.8rem;
            }

            .price-amount {
                font-size: 2rem;
            }

            .features li {
                padding: 0.7rem;
                font-size: 0.85rem;
            }
        }

        @media (max-width: 400px) {
            .pricing-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="galaxy-bg"></div>
    <div class="stars" id="stars"></div>

    <button class="sound-toggle" id="soundToggle">🔊 Sound: ON</button>

    <div class="container">
        <h1 class="logo">SELENE</h1>
        <p class="subtitle">LUNAR POMODORO TIMER</p>

        <div class="moon-container" id="moonContainer">
            <div class="glow"></div>
            <div class="moon" id="moon">
                <div class="moon-shadow" id="moonShadow"></div>
                <div class="moon-overlay" id="moonOverlay"></div>
            </div>
        </div>

        <div class="timer-display" id="timer">25:00</div>
        <div class="phase-display" id="phase">New Moon → Waxing Crescent - 🎯 Focus Time - Cycle 1/4</div>
        <p style="color: #a8c0ff; opacity: 0.6; margin-top: 1rem; font-size: 0.9rem;">✨ Click the moon to start ✨</p>
        
        <!-- Notification Permission Banner -->
        <div id="notificationBanner" style="display: none; background: rgba(196, 113, 237, 0.2); border: 2px solid #c471ed; border-radius: 15px; padding: 1rem 1.5rem; margin-top: 1.5rem; max-width: 500px; text-align: center;">
            <p style="color: #e0e0ff; margin-bottom: 0.8rem; font-size: 0.95rem;">
                🔔 <strong>Enable notifications to get alerts when your timer ends!</strong>
            </p>
            <button id="enableNotifications" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 0.7rem 1.5rem; border-radius: 50px; color: white; cursor: pointer; font-weight: 600; font-size: 0.9rem;">
                Enable Notifications
            </button>
            <button id="dismissBanner" style="background: rgba(255, 255, 255, 0.1); border: 1px solid #a8c0ff; padding: 0.7rem 1.5rem; border-radius: 50px; color: #e0e0ff; cursor: pointer; font-size: 0.9rem; margin-left: 0.5rem;">
                Maybe Later
            </button>
        </div>
        
        <!-- Pro Features Preview Section -->
        <div style="margin-top: 4rem; text-align: center; max-width: 800px; padding: 0 1rem;">
            <h3 style="color: #c471ed; font-size: 1.5rem; margin-bottom: 2rem; font-weight: 300; letter-spacing: 2px;">
                ✨ Unlock Selene Pro ✨
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
                <div style="background: rgba(168, 192, 255, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(168, 192, 255, 0.3); backdrop-filter: blur(10px);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🌌</div>
                    <h4 style="color: #a8c0ff; margin-bottom: 0.5rem; font-size: 1.1rem;">Premium Nebulas</h4>
                    <p style="color: #e0e0ff; opacity: 0.8; font-size: 0.9rem;">Explore the Crab, Orion, Eagle, and Ring Nebulas with stunning visuals</p>
                </div>
                
                <div style="background: rgba(168, 192, 255, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(168, 192, 255, 0.3); backdrop-filter: blur(10px);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🌀</div>
                    <h4 style="color: #a8c0ff; margin-bottom: 0.5rem; font-size: 1.1rem;">Galaxy Themes</h4>
                    <p style="color: #e0e0ff; opacity: 0.8; font-size: 0.9rem;">Immerse yourself in Andromeda, Whirlpool, and Sombrero galaxies</p>
                </div>
                
                <div style="background: rgba(168, 192, 255, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(168, 192, 255, 0.3); backdrop-filter: blur(10px);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🎵</div>
                    <h4 style="color: #a8c0ff; margin-bottom: 0.5rem; font-size: 1.1rem;">Celestial Sounds</h4>
                    <p style="color: #e0e0ff; opacity: 0.8; font-size: 0.9rem;">Pulsar rhythms, cosmic winds, and stellar harmonics to enhance focus</p>
                </div>
                
                <div style="background: rgba(168, 192, 255, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(168, 192, 255, 0.3); backdrop-filter: blur(10px);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🌠</div>
                    <h4 style="color: #a8c0ff; margin-bottom: 0.5rem; font-size: 1.1rem;">Shooting Stars</h4>
                    <p style="color: #e0e0ff; opacity: 0.8; font-size: 0.9rem;">Beautiful meteor animations crossing your screen as you work</p>
                </div>
                
                <div style="background: rgba(168, 192, 255, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(168, 192, 255, 0.3); backdrop-filter: blur(10px);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">📊</div>
                    <h4 style="color: #a8c0ff; margin-bottom: 0.5rem; font-size: 1.1rem;">Focus Analytics</h4>
                    <p style="color: #e0e0ff; opacity: 0.8; font-size: 0.9rem;">Track your productivity patterns and streaks over time</p>
                </div>
                
                <div style="background: rgba(168, 192, 255, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(168, 192, 255, 0.3); backdrop-filter: blur(10px);">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">🎨</div>
                    <h4 style="color: #a8c0ff; margin-bottom: 0.5rem; font-size: 1.1rem;">Custom Moons</h4>
                    <p style="color: #e0e0ff; opacity: 0.8; font-size: 0.9rem;">Choose from different moon textures and color schemes</p>
                </div>
            </div>
            
            <button class="upgrade-btn" style="font-size: 1.2rem; padding: 1.2rem 3rem; margin-bottom: 3rem;" onclick="document.getElementById('upgradeModal').style.display='flex'">
                🌟 Join Pro Waitlist - Get 50% Off at Launch!
            </button>
        </div>
    </div>

    <div class="upgrade-section">
        <button class="upgrade-btn" id="upgradeBtn">✨ UPGRADE TO PRO</button>
    </div>

    <div class="modal" id="upgradeModal">
        <div class="modal-content">
            <h2>Selene Pro</h2>
            <p class="modal-subtitle">Unlock the cosmos and elevate your focus</p>
            
            <h3 class="plan-header">Choose Your Plan</h3>
            
            <div class="pricing-container">
                <div class="price-card active" id="monthlyCard">
                    <div class="price-amount">₹299</div>
                    <div class="price-period">per month</div>
                </div>
                
                <div class="price-card" id="yearlyCard">
                    <div class="best-value">BEST VALUE</div>
                    <div class="price-amount">₹749</div>
                    <div class="price-period">per year</div>
                    <div class="price-savings">Save ₹2839 (79%)</div>
                </div>
            </div>
            
            <ul class="features">
                <li>🌌 10+ Premium Nebula Backgrounds</li>
                <li>✨ Exclusive Galaxy Themes</li>
                <li>🎵 Celestial Sound Library</li>
                <li>🌠 Shooting Star Animations</li>
                <li>📊 Advanced Focus Analytics</li>
                <li>🎨 Customizable Moon Textures</li>
            </ul>
            
            <div class="payment-info">
                <p>
                    🚀 <strong>Pro Version Coming Soon!</strong><br>
                    Join the waitlist to get early access + special launch discount<br>
                    Be the first to experience premium features
                </p>
            </div>
            
            <div style="margin: 1rem 0;">
                <input type="email" id="waitlistEmail" placeholder="Enter your email address" style="width: 100%; padding: 1rem; border: 2px solid rgba(168, 192, 255, 0.3); border-radius: 50px; background: rgba(168, 192, 255, 0.05); color: #e0e0ff; font-size: 1rem; margin-bottom: 0.5rem; outline: none;" />
                <input type="text" id="waitlistName" placeholder="Your name (optional)" style="width: 100%; padding: 1rem; border: 2px solid rgba(168, 192, 255, 0.3); border-radius: 50px; background: rgba(168, 192, 255, 0.05); color: #e0e0ff; font-size: 1rem; outline: none;" />
            </div>
            
            <button class="subscribe-btn" id="checkoutBtn">
                <span id="btnText">🌟 Join Waitlist - Get Notified</span>
            </button>
            
            <p style="text-align: center; color: #a8c0ff; font-size: 0.85rem; margin-top: 1rem; opacity: 0.7;">
                💝 Early birds get 50% off at launch!
            </p>
            <button class="close-btn" id="closeModal">Maybe Later</button>
        </div>
    </div>

    <script>
        // Create stars
        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 200; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            const size = Math.random() * 3;
            star.style.width = size + 'px';
            star.style.height = size + 'px';
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            star.style.animationDuration = `twinkle ${Math.random() * 2 + 2}s infinite, float ${Math.random() * 50 + 80}s linear infinite`;
            starsContainer.appendChild(star);
        }

        // Timer logic
        let timeInSeconds = 25 * 60; // 25 minutes work time
        let totalTime = 25 * 60;
        let isRunning = false;
        let isBreakTime = false;
        let interval;
        let currentCycle = 1;
        let audioContext;
        let oscillator;
        let gainNode;
        let soundEnabled = true;

        const timer = document.getElementById('timer');
        const phase = document.getElementById('phase');
        const moon = document.getElementById('moon');
        const moonShadow = document.getElementById('moonShadow');
        const moonOverlay = document.getElementById('moonOverlay');
        const moonContainer = document.getElementById('moonContainer');
        const upgradeBtn = document.getElementById('upgradeBtn');
        const upgradeModal = document.getElementById('upgradeModal');
        const closeModal = document.getElementById('closeModal');
        const soundToggle = document.getElementById('soundToggle');

        const phases = ['New Moon', 'Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 'Full Moon'];

        // Show notification banner if permission not granted
        window.addEventListener('load', () => {
            if ('Notification' in window) {
                if (Notification.permission === 'default') {
                    // Show the banner
                    document.getElementById('notificationBanner').style.display = 'block';
                } else if (Notification.permission === 'denied') {
                    console.log('Notifications are blocked. User needs to enable them in browser settings.');
                }
            }
        });

        // Handle enable notifications button
        document.getElementById('enableNotifications').addEventListener('click', async () => {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    document.getElementById('notificationBanner').style.display = 'none';
                    // Show test notification
                    showNotification(
                        '🌙 Notifications Enabled!',
                        'You\'ll now receive alerts when your Pomodoro sessions complete.'
                    );
                } else {
                    alert('Please allow notifications in your browser settings to receive timer alerts.');
                }
            } else {
                alert('Your browser doesn\'t support notifications.');
            }
        });

        // Handle dismiss banner button
        document.getElementById('dismissBanner').addEventListener('click', () => {
            document.getElementById('notificationBanner').style.display = 'none';
        });

        // Request notification permission on page load
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        function showNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: 'https://cdn-icons-png.flaticon.com/512/3159/3159310.png', // Moon icon
                    badge: 'https://cdn-icons-png.flaticon.com/512/3159/3159310.png',
                    tag: 'selene-timer',
                    requireInteraction: true
                });

                // Play a sound with the notification
                const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGS57OihUhELTKXh8bllHAU2jdXxz3goBS185vPTizgKEly47OulUxELTKXh8bllHAU2jdXxz3goBS185vPTizgKElw');
                audio.play().catch(e => console.log('Audio play failed:', e));

                notification.onclick = function() {
                    window.focus();
                    notification.close();
                };
            } else {
                // Fallback alert if notifications aren't supported or denied
                alert(title + '\n' + body);
            }
        }

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playAmbientSound() {
            if (!soundEnabled || !audioContext) return;
            
            if (oscillator) {
                oscillator.stop();
            }

            // Create multiple oscillators for richer sound
            oscillator = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            gainNode = audioContext.createGain();
            
            // Main tone - deeper frequency
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3 note
            
            // Harmonic tone
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(440, audioContext.currentTime); // A4 note (octave higher)
            
            // Much louder gain
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 0.1);
            
            // Add some filtering for warmth
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(800, audioContext.currentTime);
            
            oscillator.connect(filter);
            oscillator2.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.start();
            oscillator2.start();
            
            // Store second oscillator to stop it later
            window.oscillator2 = oscillator2;
        }

        function stopAmbientSound() {
            if (oscillator) {
                oscillator.stop();
                oscillator = null;
            }
            if (window.oscillator2) {
                window.oscillator2.stop();
                window.oscillator2 = null;
            }
        }

        soundToggle.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            soundToggle.textContent = soundEnabled ? '🔊 Sound: ON' : '🔇 Sound: OFF';
            
            if (!soundEnabled) {
                stopAmbientSound();
            } else if (isRunning) {
                initAudio();
                playAmbientSound();
            }
        });

        function updateDisplay() {
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = timeInSeconds % 60;
            timer.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // Calculate progress within current session (0 to 1)
            const progress = (totalTime - timeInSeconds) / totalTime;
            
            // Calculate overall moon phase based on completed cycles + current progress
            // Each cycle = 25% of full moon growth
            const completedCyclesProgress = (currentCycle - 1) * 0.25;
            const currentCycleProgress = progress * 0.25;
            const totalMoonProgress = completedCyclesProgress + currentCycleProgress;
            
            // Determine phase name based on total progress
            let phaseName;
            if (totalMoonProgress < 0.25) {
                phaseName = 'New Moon → Waxing Crescent';
            } else if (totalMoonProgress < 0.5) {
                phaseName = 'Waxing Crescent → First Quarter';
            } else if (totalMoonProgress < 0.75) {
                phaseName = 'First Quarter → Waxing Gibbous';
            } else if (totalMoonProgress < 1.0) {
                phaseName = 'Waxing Gibbous → Full Moon';
            } else {
                phaseName = '✨ Full Moon ✨';
            }
            
            const sessionType = isBreakTime ? '☕ Break Time' : '🎯 Focus Time';
            phase.textContent = `${phaseName} - ${sessionType} - Cycle ${currentCycle}/4`;

            // Start with completely invisible moon (new moon = black)
            // Gradually fade in the moon itself as it progresses
            moon.style.opacity = Math.min(1, totalMoonProgress + 0.1);
            
            // Dark overlay fades out to reveal the moon
            // At 0%: overlay is fully visible (black moon)
            // As progress increases: overlay fades revealing white crescent
            moonOverlay.style.opacity = Math.max(0, 1 - (totalMoonProgress * 1.2));
            
            // Calculate how much of the moon should be visible (crescent shape)
            const visiblePercent = totalMoonProgress * 100;
            
            // Move shadow from right to left as moon grows
            // Creates the crescent/quarter/gibbous shapes
            const shadowPosition = 100 - (visiblePercent * 2);
            moonShadow.style.transform = `translateX(${shadowPosition}%)`;
            
            // Moon glow increases dramatically as it becomes fuller
            const glowIntensity = 40 + (totalMoonProgress * 80);
            const glowOpacity = 0.3 + (totalMoonProgress * 0.7);
            moon.style.boxShadow = `
                0 0 ${glowIntensity}px rgba(255, 255, 255, ${glowOpacity}),
                0 0 ${glowIntensity * 1.5}px rgba(200, 200, 255, ${glowOpacity * 0.5}),
                inset -15px -15px 40px rgba(0, 0, 0, ${0.2 - totalMoonProgress * 0.15})
            `;
        }

        function tick() {
            if (timeInSeconds > 0) {
                timeInSeconds--;
                updateDisplay();
            } else {
                completePomodoro();
            }
        }

        function completePomodoro() {
            stopAmbientSound();
            isRunning = false;
            clearInterval(interval);
            
            if (!isBreakTime) {
                // Just finished focus time, start break
                const cyclePhase = currentCycle === 1 ? 'Waxing Crescent' : 
                                 currentCycle === 2 ? 'First Quarter' :
                                 currentCycle === 3 ? 'Waxing Gibbous' : 'Full Moon';
                
                showNotification(
                    `🎉 Focus Session ${currentCycle} Complete!`,
                    `Great work! Your moon grew to ${cyclePhase}. Time for a 5-minute break.`
                );
                
                isBreakTime = true;
                timeInSeconds = 5 * 60; // 5 minute break
                totalTime = 5 * 60;
                
                // Auto-start break after 2 seconds
                setTimeout(() => {
                    if (!isRunning) {
                        isRunning = true;
                        initAudio();
                        playAmbientSound();
                        interval = setInterval(tick, 1000);
                    }
                }, 2000);
                
            } else {
                // Just finished break time, back to focus
                showNotification(
                    '☕ Break Time Over!',
                    'Ready to focus again? Let\'s make this session count!'
                );
                
                isBreakTime = false;
                
                // Move to next cycle after break
                if (currentCycle < 4) {
                    currentCycle++;
                } else {
                    // Completed all 4 cycles - moon is now FULL!
                    showNotification(
                        '🌕 FULL MOON ACHIEVED! 🌕',
                        'Amazing! You completed all 4 Pomodoro cycles. Your moon is now fully illuminated! Take a longer break (15-30 min).'
                    );
                    currentCycle = 1; // Reset for next round
                }
                
                timeInSeconds = 25 * 60; // Back to 25 minute focus
                totalTime = 25 * 60;
            }
            
            updateDisplay();
            
            // Celebration animation
            moon.style.animation = 'pulse 1s ease-in-out 3';
            setTimeout(() => {
                moon.style.animation = '';
            }, 3000);
        }

        moonContainer.addEventListener('click', () => {
            if (!isRunning) {
                // Check if notifications are enabled, if not, show reminder
                if ('Notification' in window && Notification.permission === 'default') {
                    document.getElementById('notificationBanner').style.display = 'block';
                }
                
                initAudio();
                playAmbientSound();
                isRunning = true;
                interval = setInterval(tick, 1000);
            } else {
                isRunning = false;
                clearInterval(interval);
                
                // Reset to focus time
                isBreakTime = false;
                timeInSeconds = 25 * 60;
                totalTime = 25 * 60;
                updateDisplay();
                stopAmbientSound();
            }
        });

        upgradeBtn.addEventListener('click', () => {
            upgradeModal.style.display = 'flex';
        });

        closeModal.addEventListener('click', () => {
            upgradeModal.style.display = 'none';
        });

        upgradeModal.addEventListener('click', (e) => {
            if (e.target === upgradeModal) {
                upgradeModal.style.display = 'none';
            }
        });

        updateDisplay();

        // Pricing selection
        let selectedPlan = 'monthly';
        
        function selectPlan(plan) {
            selectedPlan = plan;
            const monthlyCard = document.getElementById('monthlyCard');
            const yearlyCard = document.getElementById('yearlyCard');
            
            if (plan === 'monthly') {
                monthlyCard.classList.add('active');
                yearlyCard.classList.remove('active');
            } else {
                yearlyCard.classList.add('active');
                monthlyCard.classList.remove('active');
            }
        }
        
        // Add click listeners after modal content is loaded
        setTimeout(() => {
            const monthlyCard = document.getElementById('monthlyCard');
            const yearlyCard = document.getElementById('yearlyCard');
            
            if (monthlyCard && yearlyCard) {
                monthlyCard.addEventListener('click', () => selectPlan('monthly'));
                yearlyCard.addEventListener('click', () => selectPlan('yearly'));
                console.log('Pricing cards initialized successfully');
            }
        }, 100);

        // Waitlist System
        const waitlistData = [];
        
        document.getElementById('checkoutBtn').addEventListener('click', async () => {
            const email = document.getElementById('waitlistEmail').value.trim();
            const name = document.getElementById('waitlistName').value.trim();
            
            // Validate email
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            // Store waitlist data
            const waitlistEntry = {
                email: email,
                name: name || 'Anonymous',
                plan: selectedPlan,
                timestamp: new Date().toISOString(),
                planPrice: selectedPlan === 'monthly' ? '₹299/month' : '₹749/year'
            };
            
            // In a real app, you would send this to your backend/database
            // For now, we'll store it in memory and log it
            waitlistData.push(waitlistEntry);
            
            console.log('=== NEW WAITLIST SIGNUP ===');
            console.log('Email:', email);
            console.log('Name:', name || 'Not provided');
            console.log('Interested Plan:', selectedPlan === 'monthly' ? 'Monthly (₹299)' : 'Yearly (₹749)');
            console.log('Total Waitlist:', waitlistData.length);
            console.log('========================');
            
            // Show success message
            alert(`🎉 You're on the waitlist!\n\nWe'll email you at ${email} when Selene Pro launches.\n\n💝 As an early supporter, you'll get 50% off!`);
            
            // Clear form
            document.getElementById('waitlistEmail').value = '';
            document.getElementById('waitlistName').value = '';
            
            // Close modal
            document.getElementById('upgradeModal').style.display = 'none';
            
            // Optional: Send to Google Sheets or other service
            // You can integrate this later when ready
        });
        
        // Later, when you're ready to enable payments, replace the above with:
        // Razorpay Integration (commented out for now)
        /*
        const RAZORPAY_KEY_ID = 'rzp_test_YOUR_KEY_ID_HERE';
        const RAZORPAY_MONTHLY_PLAN_ID = 'plan_YOUR_MONTHLY_PLAN_ID';
        const RAZORPAY_YEARLY_PLAN_ID = 'plan_YOUR_YEARLY_PLAN_ID';
        
        document.getElementById('checkoutBtn').addEventListener('click', async () => {
            const planId = selectedPlan === 'monthly' ? RAZORPAY_MONTHLY_PLAN_ID : RAZORPAY_YEARLY_PLAN_ID;
            const amount = selectedPlan === 'monthly' ? 29900 : 74900;
            const planName = selectedPlan === 'monthly' ? 'Monthly' : 'Yearly';
            
            const options = {
                key: RAZORPAY_KEY_ID,
                amount: amount,
                currency: 'INR',
                name: 'Selene Pro',
                description: `${planName} Subscription`,
                handler: function (response) {
                    alert('🎉 Payment Successful! Welcome to Selene Pro!');
                    document.getElementById('upgradeModal').style.display = 'none';
                },
                prefill: { name: '', email: '', contact: '' },
                theme: { color: '#667eea' }
            };
            
            const rzp = new Razorpay(options);
            rzp.open();
        });
        */
    </script>
</body>
</html>